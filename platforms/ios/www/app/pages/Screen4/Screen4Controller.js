define(['require', 'app'], function(require, APP) {

    /**
     * Controller for Screen4 generated by Appery.io
     * @module Screen4
     */

    APP.controller('Screen4', ['$scope', 'Apperyio', controller]);

    function controller($scope, Apperyio) {

        /**
         * user controller variables
         */
        $scope.taskDescriptionVar = Apperyio.EntityAPI('String');
        $scope.incomingThought = Apperyio.EntityAPI('String');
        $scope.numNegativeThoughts = Apperyio.EntityAPI('Number');
        $scope.currentNegativeThought = Apperyio.EntityAPI('String');
        $scope.currentNegativeThoughtIndex = Apperyio.EntityAPI('Number');

        /**
         * User controller functions
         */
        /**
         * @function init
         */
        $scope.init = function() {
            //On load screen logic
            $scope.thoughts = [];
            $scope.positiveThoughts = [];
            var $routeParams = Apperyio.get("$routeParams");
            if ($routeParams.a1 == "path2") {
                $scope.taskDescriptionVar = $routeParams.a2;
            } else {
                $scope.taskDescriptionVar = $routeParams.a3;
                $scope.thoughts = $routeParams.a2.split(",");
            }
            //console.log($scope.taskDescriptionVar);
            //console.log( $scope.thoughts);
            $scope.numNegativeThoughts = $scope.thoughts.length;
            $scope.currentNegativeThoughtIndex = 0;
            if ($scope.numNegativeThoughts > 0) {
                $scope.currentNegativeThought = $scope.thoughts[$scope.currentNegativeThoughtIndex];
            } else {
                $scope.currentNegativeThought = "";
            }

        };

        /**
         * @function openCognitiveDistortions
         */
        $scope.openCognitiveDistortions = function() {
            var modalOptions = { // About Ionic Modal: https://links.appery.io/ve-snippet-modal-ionic
                animation: 'slide-in-up',
                // The animation to show & hide with
                focusFirstInput: false,
                // Whether to autofocus the first input of the modal when shown
                backdropClickToClose: true,
                // Whether to close the modal on clicking the backdrop
                hardwareBackButtonClose: true // Whether the modal can be closed using the hardware back button on Android and similar devices
            };

            Apperyio.get('Modals').loadModal("Modal2").then(

            function(modalInstance) {
                modalInstance.open(modalOptions).then(function(modal) {
                    modal.scope.modal = modal;
                    modal.show();
                });
            }, function(error) {
                console.log(error);
            });

        };

        /**
         * @function breathe
         */
        $scope.breathe = function() {
            Apperyio.navigateTo("Screen6", {
                a1: $scope.taskDescriptionVar
            });

        };

        /**
         * @function addPositiveThought
         */
        $scope.addPositiveThought = function() {
            if ($scope.incomingThought) {
                $scope.positiveThoughts.push($scope.incomingThought);
                $scope.incomingThought = "";
                $scope.currentNegativeThoughtIndex++;
                if ($scope.currentNegativeThoughtIndex > ($scope.numNegativeThoughts - 1)) {
                    $scope.currentNegativeThought = "";
                } else {
                    $scope.currentNegativeThought = $scope.thoughts[$scope.currentNegativeThoughtIndex];
                }
            }
        };

    }

});